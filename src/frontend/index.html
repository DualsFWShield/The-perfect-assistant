<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Assistant Personnel ZeroConfig - Votre assistant vocal personnel s√©curis√©">
  <meta name="theme-color" content="#3498db">
  
  <title>Assistant Personnel</title>
  
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/icon-192x192.png">
  <link rel="apple-touch-icon" href="images/icon-192x192.png">
  
  <!-- Localforage pour stockage local -->
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  
  <!-- CryptoJS pour chiffrement c√¥t√© client -->
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- Preact (pour la compatibilit√© avec les composants React mais en plus l√©ger) -->
  <script src="https://cdn.jsdelivr.net/npm/preact@10.13.2/dist/preact.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/preact@10.13.2/hooks/dist/hooks.umd.js"></script>
  
  <!-- Composants Web personnalis√©s -->
  <script src="components/auth-component.js"></script>
  <script src="components/voice-assistant.js"></script>
</head>
<body>
  <header>
    <div class="logo">
      <img src="images/logo.svg" alt="Logo Assistant Personnel">
      <h1>Assistant Personnel</h1>
    </div>
    <div class="user-section">
      <auth-component id="auth"></auth-component>
    </div>
  </header>
  
  <main>
    <section class="welcome-section">
      <h2>Bienvenue sur votre Assistant Personnel</h2>
      <p>G√©rez vos emails, calendrier et t√¢ches √† l'aide de commandes vocales simples.</p>
      <div class="status-indicator">
        <div class="status online">
          <span class="dot"></span>
          <span class="text">Connect√©</span>
        </div>
      </div>
    </section>
    
    <section class="assistant-section">
      <voice-assistant id="assistant"></voice-assistant>
    </section>
    
    <section class="examples-section">
      <h3>Exemples de commandes</h3>
      <div class="command-examples">
        <div class="example">
          <div class="icon">üìß</div>
          <div class="text">"R√©sume mes emails non lus de Jean"</div>
        </div>
        <div class="example">
          <div class="icon">üóìÔ∏è</div>
          <div class="text">"Bloque 2h demain pour le projet Zephyr avec rappel SMS"</div>
        </div>
        <div class="example">
          <div class="icon">üçΩÔ∏è</div>
          <div class="text">"D√©jeuner avec Marc et Sophie (marc@mail.com, sophie@proton.me) vendredi midi"</div>
        </div>
      </div>
    </section>
  </main>
  
  <footer>
    <div class="footer-content">
      <p>Assistant Personnel ZeroConfig - Version 1.0.0</p>
      <p>Utilisant Gemini 1.5 Flash & Cloudflare Workers</p>
      <p class="security-notice">üîí Toutes les donn√©es sont chiffr√©es localement</p>
    </div>
  </footer>
  
  <!-- Service Worker pour la PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('Service Worker enregistr√© avec succ√®s:', registration.scope);
          })
          .catch(error => {
            console.error('√âchec d\'enregistrement du Service Worker:', error);
          });
      });
    }
    
    // Configuration du stockage local
    localforage.config({
      name: 'personal-assistant',
      version: 1.0,
      storeName: 'assistant_data',
      description: 'Stockage local pour l\'Assistant Personnel'
    });
    
    // Chiffrement/d√©chiffrement des donn√©es sensibles
    const encryption = {
      // Cl√© de chiffrement unique par appareil (g√©n√©r√©e √† l'installation)
      key: localStorage.getItem('encryption_key') || this.generateEncryptionKey(),
      
      // G√©n√©rer une cl√© de chiffrement al√©atoire
      generateEncryptionKey() {
        const key = CryptoJS.lib.WordArray.random(32).toString();
        localStorage.setItem('encryption_key', key);
        return key;
      },
      
      // Chiffrer les donn√©es
      encrypt(data) {
        return CryptoJS.AES.encrypt(JSON.stringify(data), this.key).toString();
      },
      
      // D√©chiffrer les donn√©es
      decrypt(encryptedData) {
        try {
          const bytes = CryptoJS.AES.decrypt(encryptedData, this.key);
          return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
        } catch (e) {
          console.error('Erreur de d√©chiffrement:', e);
          return null;
        }
      },
      
      // Stocker des donn√©es chiffr√©es
      async store(key, data) {
        const encrypted = this.encrypt(data);
        await localforage.setItem(key, encrypted);
      },
      
      // R√©cup√©rer des donn√©es chiffr√©es
      async retrieve(key) {
        const encrypted = await localforage.getItem(key);
        if (!encrypted) return null;
        return this.decrypt(encrypted);
      }
    };
    
    // Initialiser la connexion entre les composants
    document.addEventListener('DOMContentLoaded', () => {
      const authComponent = document.getElementById('auth');
      const assistantComponent = document.getElementById('assistant');
      
      // Mettre √† jour l'indicateur de statut en fonction de la connexion r√©seau
      function updateStatusIndicator() {
        const statusIndicator = document.querySelector('.status');
        if (navigator.onLine) {
          statusIndicator.className = 'status online';
          statusIndicator.querySelector('.text').textContent = 'Connect√©';
        } else {
          statusIndicator.className = 'status offline';
          statusIndicator.querySelector('.text').textContent = 'Hors ligne';
        }
      }
      
      // √âcouter les changements de connexion
      window.addEventListener('online', updateStatusIndicator);
      window.addEventListener('offline', updateStatusIndicator);
      
      // Initialiser le statut
      updateStatusIndicator();
    });
  </script>
</body>
</html>